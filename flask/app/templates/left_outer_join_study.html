{% extends "base.html" %}
{% block title %}LEFT OUTER JOINの学習ページ{% endblock %}
{% block content %}
<div class="nav-buttons">
    <a href="/index/join?flag=min" class="prev">◀ 前へ</a>
    <a href="/basic/join/left_outer_join/example" class="next">次へ ▶</a>
</div>
<div class="learning-container">
    <h1>LEFT OUTER JOIN</h1>

    <p><strong>LEFT OUTER JOINとは:</strong> LEFT OUTER JOINは、左側のテーブルのすべての行を取得し、右側のテーブルに対応する行があれば結合し、なければNULLを返す結合方法です。このため、左側のテーブルにあるデータは必ず取得され、右側に対応するデータが存在しない場合でも結果に含まれます。</p>

    <p><strong>WHERE句の使用:</strong> LEFT OUTER JOINの結果に対してWHERE句を使用することで、条件に一致する行のみを絞り込むことができます。ただし、WHERE句を使うときには、NULL値を考慮する必要があります。</p>

    <p><strong>例:</strong> 例えば、<code>products</code>テーブルと<code>customers</code>テーブルに対してLEFT OUTER JOINを実行し、その結果を<code>WHERE products.price > 50000</code>という条件で絞り込むと、全ての<code>products</code>のデータが取得され、対応する<code>customers</code>データが無い場合はNULLとして表示されます。</p>

    {% if error_message %}
        <p class="error-message">{{ error_message }}</p>
    {% endif %}

    <table class="example-table">
        <caption>products</caption>
        <tr class="products-col">
            <th>商品ID</th>
            <th>商品名</th>
            <th>価格</th>
            <th>在庫数</th>
            <th>ステータス</th>
        </tr>
        <tr class="products-col">
            {% for col in products_desc %}
                <th>{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in products_data %}
            <tr class="products-cell">
                {% for item in row %}
                    <td>{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <table class="example-table">
        <caption>customers</caption>
        <tr class="customers-col">
            <th>購入者ID</th>
            <th>商品ID</th>
            <th>購入日</th>
        </tr>
        <tr class="customers-col">
            {% for col in customers_desc %}
                <th>{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in customers_data %}
            <tr class="customers-cell">
                {% for item in row %}
                    <td>{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <form method="POST">
        <div class="form-group">
            <p>SELECT</p>
            <input type="text" id="columns" name="columns" placeholder="カラム:products.product_id, customers.order_date" required>
        </div>

        <div class="form-group">
            <p>FROM</p>
            <input type="text" id="table1_name" name="table1_name" placeholder="テーブル名:products or customers" value="{{ table1_name if table1_name else '' }}" required>
        </div>

        <div class="form-group">
            <p>LEFT OUTER JOIN</p>
            <input type="text" id="table2_name" name="table2_name" placeholder="テーブル名:products or customers" value="{{ table2_name if table2_name else '' }}" required>
        </div>

        <div class="form-group">
            <p>ON</p>
            <input type="text" name="on_clause" placeholder="条件:products.product_id = customers.product_id" required>
        </div>

        <div class="form-group">
            <input type="checkbox" id="use_where" name="use_where" onclick="toggleWhereCondition()">
            <label for="use_where">WHEREを使用する</label>
        </div>

        <div id="where_condition_container" class="form-group" style="display: none;">
            <p>WHERE</p>
            <input type="text" name="where_condition" placeholder="(例) products.price > 50000">
        </div>

        <div class="btn-container">
            <button class="btn" type="submit">LEFT OUTER JOINを実行</button>
        </div>
    </form>

    {% if left_outer_join_result %}
        <h2>LEFT OUTER JOINの結果</h2>
        <p><strong>実行クエリ:</strong> {{ left_outer_join_query }}</p>
        <table class="example-table">
            <tr>
                {% for col in columns.split(',') %}
                    <th
                        class="{% if 'products.' in col.strip() %}products-col{% elif 'customers.' in col.strip() %}customers-col{% endif %}">
                        {{ col.strip() }}
                    </th>
                {% endfor %}
            </tr>
            {% for row in left_outer_join_result %}
                <tr>
                    {% for item in row %}
                        <td
                            class="{% if 'products.' in columns.split(',')[loop.index0].strip() %}products-cell{% elif 'customers.' in columns.split(',')[loop.index0].strip() %}customers-cell{% endif %}">
                            {{ item }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <div class="nav-buttons">
        <a href="/index/join?flag=min" class="prev">◀ 前へ</a>
        <a href="/basic/join/left_outer_join/example" class="next">次へ ▶</a>
    </div>
</div>

<script>
    function toggleWhereCondition() {
        var whereContainer = document.getElementById('where_condition_container');
        whereContainer.style.display = (whereContainer.style.display === 'none') ? 'block' : 'none';
    }
</script>
{% endblock %}
