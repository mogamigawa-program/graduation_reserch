{% extends "base.html" %}
{% block title %}LEFT OUTER JOINの学習ページ（高度版）{% endblock %}
{% block content %}

<div class="learning-container">
    <!-- ナビゲーションボタン（上） -->
    <div class="nav-buttons">
        <a href="/basic/join/left_outer_join/example" class="prev">◀ 前へ</a>
        <a href="/basic/join/left_outer_join/quiz" class="next">次へ ▶</a>
    </div>

    <h1>LEFT OUTER JOINの演習ページ（実践）</h1>

    <p><strong>このページでは、SQLクエリを自由に記述して実行できます。</strong></p>
    <p class="error-message"><strong>LEFT OUTER JOINを使って、左側のテーブルを基準に結合してみましょう！</strong></p>
    <p>以下のテキストボックスにクエリを入力し、「クエリを実行」をクリックしてください。</p>

    <!-- productsテーブルの中身を表示 -->
    <h2>productsテーブルの内容</h2>
    <table class="example-table">
        <caption>products</caption>
        <tr class="products-col">
            {% for col in products_desc %}
                <th>{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in products_data %}
            <tr class="products-cell">
                {% for item in row %}
                    <td>{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <!-- customersテーブルの中身を表示 -->
    <h2>customersテーブルの内容</h2>
    <table class="example-table">
        <caption>customers</caption>
        <tr class="products-col">
            {% for col in customers_desc %}
                <th>{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in customers_data %}
            <tr class="products-cell">
                {% for item in row %}
                    <td>{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <!-- ヒントの追加 -->
    <div class="hints">
        <h2>ヒント</h2>

        <details>
            <summary class="hint-summary">ヒント1</summary>
            <p>SELECTは、データベースからデータを取得するための基本的なSQL文です。</p>
            <p>例：SELECT ...;</p>
        </details>

        <details>
            <summary class="hint-summary">ヒント2</summary>
            <p>カラムは、テーブルから選択するフィールドです。<br>
                複数のカラムを使用するときは、","で区切りましょう。<br>
                また、"*"はすべてのカラムを指します。</p>
            <p>例：SELECT products.product_id, customers.customer_id ...;<br>
                例：SELECT * ...;</p>
        </details>

        <details>
            <summary class="hint-summary">ヒント3</summary>
            <p>FROMは、データを取得するテーブルを指定するSQL文です。ここではproductsテーブルを使っています。</p>
            <p>例：SELECT * FROM products ...;</p>
        </details>

        <details>
            <summary class="hint-summary">ヒント4</summary>
            <p>LEFT OUTER JOINは、左のテーブル(ここではproducts)のデータをすべて表示し、右のテーブル(ここではcustomers)に一致するデータがあれば表示します。<br>
                一致するデータがない場合は、右側のカラムにNULL（空の値） が入ります。</p>
            <p>例：SELECT * FROM products <br>
                LEFT OUTER JOIN customers ON products.product_id = customers.product_id;</p>
        </details>

        <details>
            <summary class="hint-summary">ヒント5</summary>
            <p>クエリ内で条件を指定したい場合、WHERE句を使います。<br>
                WHERE products.product_name LIKE 'P%' は products.product_name が P から始まるものという意味です。</p>
            <p>例：SELECT * FROM products <br>
                LEFT OUTER JOIN customers ON products.product_id = customers.product_id <br>
                WHERE products.product_name LIKE 'P%'; </p>
        </details>
    </div>

    {% if error_message %}
        <p class="error-message">{{ error_message }}</p>
    {% endif %}

    <form method="POST">
        <label for="query">SQLクエリ:
            <p class="error-message"><strong>クエリの最後には";"をつけよう！</strong></p>
        </label>
        <textarea id="query" name="query" rows="5" required>{{ query if query }}</textarea>
        <br>
        <button class="btn" type="submit">クエリを実行</button>
    </form>

    {% if query %}
        <h2>実行したクエリ</h2>
        <p><code>{{ query }}</code></p>
    {% endif %}

    {% if query_result %}
        <h2>クエリ結果</h2>
        <table class="example-table">
            <tr class="join-header">
                {% for col in query_result["columns"] %}
                    <th>{{ col }}</th>
                {% endfor %}
            </tr>
            {% for row in query_result["data"] %}
                <tr class="join-cell">
                    {% for item in row %}
                        <td>{{ item }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <!-- ナビゲーションボタン（下） -->
    <div class="nav-buttons">
        <a href="/basic/join/left_outer_join/example" class="prev">◀ 前へ</a>
        <a href="/basic/join/left_outer_join/quiz" class="next">次へ ▶</a>
    </div>
</div>

{% endblock %}
