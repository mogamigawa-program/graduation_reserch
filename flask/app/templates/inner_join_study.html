{% extends "base.html" %}
{% block title %}INNER JOINの学習ページ{% endblock %}
{% block content %}
<div class="nav-buttons">
    <a href="/index/join?flag=min" class="prev">◀ 前へ</a>
    <a href="/basic/join/inner_join/example" class="next">次へ ▶</a>
</div>
<div class="learning-container">
    <h1>INNER JOIN</h1>

    <p><strong>INNER JOINとは:</strong> INNER JOINは、2つのテーブルの共通するカラムの値が一致する行だけを結合する方法です。INNER JOINを使用すると、指定した結合条件に基づいて、両方のテーブルに存在する行のみが結果に含まれます。</p>

    <p><strong>WHERE句の使用:</strong> INNER JOINの結果に対してWHERE句を使うことで、さらに絞り込んだデータを取得できます。JOIN条件とは別に、条件を付けて分析する際に便利です。</p>

    <p><strong>例:</strong> 例えば、<code>products</code>テーブルと<code>customers</code>テーブルに対してINNER JOINを実行し、<code>ON products.product_id = customers.product_id</code>という条件で結合することで、両テーブルに共通する商品のみを取得できます。</p>

    {% if error_message %}
        <p class="alert-error">{{ error_message }}</p>
    {% endif %}

    <!-- productsテーブル -->
    <h2>productsテーブルの内容</h2>
    <table class="example-table">
        <caption>products</caption>
        <tr>
            {% for col in products_desc %}
                <th class="products-col">{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in products_data %}
            <tr>
                {% for item in row %}
                    <td class="products-cell">{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <!-- customersテーブル -->
    <h2>customersテーブルの内容</h2>
    <table class="example-table">
        <caption>customers</caption>
        <tr>
            {% for col in customers_desc %}
                <th class="customers-col">{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in customers_data %}
            <tr>
                {% for item in row %}
                    <td class="customers-cell">{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <!-- クエリフォーム -->
    <form method="POST">
        <p>SELECT</p>
        <input type="text" id="columns" name="columns" placeholder="例: products.product_id, customers.order_date" required>

        <p>FROM</p>
        <input type="text" id="table1_name" name="table1_name" placeholder="例: products" value="{{ table1_name if table1_name else '' }}" required>

        <p>INNER JOIN</p>
        <input type="text" id="table2_name" name="table2_name" placeholder="例: customers" value="{{ table2_name if table2_name else '' }}" required>

        <p>ON</p>
        <input type="text" name="on_clause" placeholder="例: products.product_id = customers.product_id" required>

        <br><br>
        <input type="checkbox" id="use_where" name="use_where" onclick="toggleWhereCondition()">
        <label for="use_where">WHEREを使用する</label>

        <div id="where_condition_container" style="display: none;">
            <p>WHERE</p>
            <input type="text" name="where_condition" placeholder="例: products.price > 50000">
        </div>

        <br>
        <button type="submit" class="btn">INNER JOINを実行</button>
    </form>

    <script>
        function toggleWhereCondition() {
            var whereContainer = document.getElementById('where_condition_container');
            whereContainer.style.display = (whereContainer.style.display === 'none') ? 'block' : 'none';
        }
    </script>

    <!-- INNER JOIN 結果表示 -->
    {% if inner_join_result %}
        <h2>INNER JOINの結果</h2>
        <p><strong>実行クエリ:</strong> {{ inner_join_query }}</p>
        <table class="example-table">
            <tr>
                {% for col in columns.split(',') %}
                    <th 
                        {% if 'products.' in col.strip() %} class="products-col"{% endif %}
                        {% if 'customers.' in col.strip() %} class="customers-col"{% endif %}
                    >
                        {{ col.strip() }}
                    </th>
                {% endfor %}
            </tr>
            {% for row in inner_join_result %}
                <tr>
                    {% for item in row %}
                        <td
                            {% if 'products.' in columns.split(',')[loop.index0].strip() %} class="products-cell"{% endif %}
                            {% if 'customers.' in columns.split(',')[loop.index0].strip() %} class="customers-cell"{% endif %}
                        >
                            {{ item }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}
</div>

<div class="nav-buttons">
    <a href="/index/join?flag=min" class="prev">◀ 前へ</a>
    <a href="/basic/join/inner_join/example" class="next">次へ ▶</a>
</div>

{% endblock %}
