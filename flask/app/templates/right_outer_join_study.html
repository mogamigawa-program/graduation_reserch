{% extends "base.html" %}
{% block title %}RIGHT OUTER JOINの学習ページ{% endblock %}
{% block content %}

<div class="learning-container">

    <!-- ナビゲーションボタン（上部） -->
    <div class="nav-buttons">
        <a href="/index/join?flag=min" class="prev">◀ 前へ</a>
        <a href="/basic/join/right_outer_join/example" class="next">次へ ▶</a>
    </div>

    <h1>RIGHT OUTER JOIN</h1>

    <p><strong>RIGHT OUTER JOINとは:</strong> 右側のテーブルのすべての行を取得し、左側のテーブルに対応する行がなければ NULL を返す結合方法です。</p>
    <p><strong>WHERE句の使用:</strong> NULL 値を考慮しつつ条件を指定できます。</p>
    <p><strong>例:</strong> RIGHT OUTER JOIN + <code>WHERE customers.customer_id IS NOT NULL</code> により customers のデータが主で取得されます。</p>

    {% if error_message %}
        <p class="error-message">{{ error_message }}</p>
    {% endif %}

    <!-- products テーブル -->
    <table class="table">
        <caption>products</caption>
        <tr class="products-color">
            {% for col in products_desc %}
                <th>{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in products_data %}
            <tr class="products-row">
                {% for item in row %}
                    <td>{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <!-- customers テーブル -->
    <table class="table">
        <caption>customers</caption>
        <tr class="customers-color">
            {% for col in customers_desc %}
                <th>{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in customers_data %}
            <tr class="customers-row">
                {% for item in row %}
                    <td>{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <!-- クエリ入力フォーム -->
    <form method="POST" class="query-form">
        <label for="columns">SELECT</label>
        <input type="text" id="columns" name="columns" placeholder="products.product_id, customers.order_date" required>

        <label for="table1_name">FROM</label>
        <input type="text" id="table1_name" name="table1_name" placeholder="products or customers" value="{{ table1_name if table1_name else '' }}" required>

        <label for="table2_name">RIGHT OUTER JOIN</label>
        <input type="text" id="table2_name" name="table2_name" placeholder="products or customers" value="{{ table2_name if table2_name else '' }}" required>

        <label for="on_clause">ON</label>
        <input type="text" name="on_clause" placeholder="products.product_id = customers.product_id" required>

        <div class="checkbox-group">
            <input type="checkbox" id="use_where" name="use_where" onclick="toggleWhereCondition()">
            <label for="use_where">WHEREを使用する</label>
        </div>

        <div id="where_condition_container" style="display: none;">
            <label for="where_condition">WHERE</label>
            <input type="text" name="where_condition" placeholder="(例) products.price > 50000">
        </div>

        <button type="submit" class="btn">RIGHT OUTER JOINを実行</button>
    </form>

    <script>
        function toggleWhereCondition() {
            const whereContainer = document.getElementById('where_condition_container');
            whereContainer.style.display = (whereContainer.style.display === 'none') ? 'block' : 'none';
        }
    </script>

    <!-- 結果の表示 -->
    {% if right_outer_join_result %}
        <h2>RIGHT OUTER JOINの結果</h2>
        <p><strong>実行クエリ:</strong> {{ right_outer_join_query }}</p>

        <table class="table">
            <tr>
                {% for col in columns.split(',') %}
                    <th class="{% if 'products.' in col.strip() %}products-color{% elif 'customers.' in col.strip() %}customers-color{% endif %}">
                        {{ col.strip() }}
                    </th>
                {% endfor %}
            </tr>
            {% for row in right_outer_join_result %}
                <tr>
                    {% for item in row %}
                        <td class="{% if 'products.' in columns.split(',')[loop.index0].strip() %}products-row{% elif 'customers.' in columns.split(',')[loop.index0].strip() %}customers-row{% endif %}">
                            {{ item }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <!-- ナビゲーションボタン（下部） -->
    <div class="nav-buttons">
        <a href="/index/join?flag=min" class="prev">◀ 前へ</a>
        <a href="/basic/join/right_outer_join/example" class="next">次へ ▶</a>
    </div>

</div>

{% endblock %}
