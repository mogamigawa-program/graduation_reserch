{% extends "base.html" %}
{% block title %}UPDATE文（JOIN）{% endblock %}
{% block content %}

<div class="nav-buttons">
    <a href="/basic/update/join/example" class="prev">◀ 前へ</a>
    <a href="/quiz/update_join" class="next">次へ ▶</a>
</div>

<div class="learning-container">
    <h1>UPDATE文 × JOIN句</h1>

    <section>
        <h2>UPDATE文とJOINの組み合わせ</h2>
        <p>複数のテーブルを結合しながら、関連するデータをまとめて更新することができます。</p>
    </section>

    <section>
        <h2>基本構文</h2>
        <div class="code-block">
<code>UPDATE テーブルA
JOIN テーブルB ON 結合条件
SET テーブルA.カラム = 更新内容
WHERE 条件;</code>
        </div>
    </section>

    <section>
        <h2>使用例</h2>
        <div class="code-block">
<code>UPDATE products
JOIN discounts d ON products.category_id = d.category_id
SET products.price = products.price * d.discount_rate;</code>
        </div>
        <p>上記のクエリでは、<code>discounts</code>テーブルの割引率を基に、<code>products</code>の価格を一括更新します。</p>
    </section>

    <section>
        <h2>実際のテーブル</h2>

        <h3>productsテーブル</h3>
        <table class="example-table">
            <thead>
                <tr>
                    {% for col in products_desc %}
                        <th>{{ col[0] }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in products_data %}
                    <tr>
                        {% for item in row %}
                            <td>{{ item }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3>discountsテーブル</h3>
        <table class="example-table">
            <thead>
                <tr>
                    {% for col in discounts_desc %}
                        <th>{{ col[0] }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in discounts_data %}
                    <tr>
                        {% for item in row %}
                            <td>{{ item }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section>
        <h2>UPDATE実行フォーム</h2>
        {% if error_message %}
            <p class="error">{{ error_message }}</p>
        {% endif %}
        {% if message %}
            <p class="message">{{ message }}</p>
        {% endif %}

        <form method="POST" class="form">
            <label>SET句：</label>
            <input type="text" name="set_clause" placeholder="price = price * 0.9">

            <label>JOIN句を使う</label>
            <select name="join_table">
                <option value="discounts">discounts</option>
                <option value="customers">customers</option>
                <option value="inventory">inventory</option>
            </select>

            <input type="text" name="join_condition" placeholder="products.category_id = discounts.category_id">

            <label>WHERE句（任意）</label>
            <input type="text" name="where_clause" placeholder="price > 1000">

            <button type="submit" class="btn">実行する</button>
            <button type="submit" name="restore" class="btn btn-secondary">元に戻す</button>
        </form>
    </section>
</div>

<div class="nav-buttons">
    <a href="/basic/update/join/example" class="prev">◀ 前へ</a>
    <a href="/quiz/update_join" class="next">次へ ▶</a>
</div>

{% endblock %}
