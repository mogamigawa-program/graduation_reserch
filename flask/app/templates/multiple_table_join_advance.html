{% extends "base.html" %}
{% block title %}複数テーブルの結合演習ページ（高度版）{% endblock %}
{% block content %}

<div class="container">
    <div class="nav-buttons">
        <a href="/basic/join/multiple_table_join/study" class="prev">◀ 前へ</a>
        <a href="/basic/join/join_quiz" class="next">まとめクイズへ ▶</a>
    </div>
    <h1>複数テーブルのJOIN演習ページ（実践）</h1>

    <p><strong>このページでは、複数のテーブルを結合する演習を行います。</strong></p>
    <p style="color: red;"><strong>テーブルを結合して、必要な情報を取り出してみましょう！</strong></p>
    <p>以下のテキストボックスにSQLクエリを入力し、「クエリを実行」をクリックしてください。</p>

    {% for name, desc, data in [
        ('products', products_desc, products_data),
        ('customers', customers_desc, customers_data),
        ('discounts', discounts_desc, discounts_data),
        ('inventory', inventory_desc, inventory_data)
    ] %}
        <h2>{{ name }}テーブルの内容</h2>
        <table border="1">
            <caption>{{ name }}</caption>
            <tr style="background-color: rgb(255, 123, 0);">
                {% for col in desc %}
                    <th>{{ col[0] }}</th>
                {% endfor %}
            </tr>
            {% for row in data %}
                <tr style="background-color: rgb(240, 184, 128);">
                    {% for item in row %}
                        <td>{{ item }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    {% endfor %}

    <div class="hints">
        <h2>ヒント</h2>

        <details>
            <summary style="color: blue;">ヒント1</summary>
            <p>SELECTは、データベースからデータを取得するための基本的なSQL文です。</p>
            <p>例：SELECT ...;</p>
        </details>

        <details>
            <summary style="color: blue;">ヒント2</summary>
            <p>カラムは、テーブルから選択するフィールドです。<br>
                複数のカラムを使用するときは、","で区切りましょう。<br>
                また、"*"はすべてのカラムを指します。</p>
            <p>例：SELECT products.product_id, customers.customer_id ...;<br>
                例：SELECT * ...;</p>
        </details>

        <details>
            <summary style="color: blue;">ヒント3</summary>
            <p>FROMは、データを取得するテーブルを指定するSQL文です。ここではproductsテーブルを使っています。</p>
            <p>例：SELECT * FROM products ...;</p>
        </details>
    
        <details>
            <summary style="color: blue;">ヒント4</summary>
            <p>他のテーブルからデータを取得する場合、JOINを使います。</p>
            <ul>
                <li>CROSS JOIN：全ての組み合わせ</li>
                <li>INNER JOIN：共通のカラムで結合</li>
                <li>LEFT OUTER JOIN：左側全て + 一致データ</li>
                <li>RIGHT OUTER JOIN：右側全て + 一致データ</li>
            </ul>
            <p>例：<br>
                SELECT products.product_name, customers.customer_id <br>
                FROM products <br>
                INNER JOIN customers ON products.product_id = customers.product_id;
            </p>
        </details>

        <details>
            <summary style="color: blue;">ヒント5</summary>
            <p>複数のテーブルを結合するには、JOINを複数回使います。</p>
            <p>例：<br>
                SELECT products.product_name, customers.customer_id, discounts.discount_rate <br>
                FROM products <br>
                INNER JOIN customers ON products.product_id = customers.product_id <br>
                INNER JOIN discounts ON products.product_id = discounts.product_id;
            </p>
        </details>

        <details>
            <summary style="color: blue;">ヒント6</summary>
            <p>特定の条件に絞ってデータを取得するには、WHERE句を使います。</p>
            <p>例：<br>
                SELECT products.product_name, customers.customer_id, discounts.discount_rate, inventory.quantity_change <br>
                FROM products <br>
                INNER JOIN customers ON products.product_id = customers.product_id <br>
                INNER JOIN discounts ON products.product_id = discounts.product_id <br>
                INNER JOIN inventory ON products.product_id = inventory.product_id <br>
                WHERE products.status = 'Active';
            </p>
        </details>
    </div>

    {% if error_message %}
        <p style="color: red;">{{ error_message }}</p>
    {% endif %}

    <form method="POST">
        <label for="query">
            SQLクエリ:
            <p style="color: red;"><strong>クエリの最後には「;」をつけよう！</strong></p>
        </label>
        <textarea id="query" name="query" rows="5" required>{{ query if query }}</textarea>
        <br>
        <button type="submit" class="btn">クエリを実行</button>
    </form>

    {% if query %}
        <h2>実行したクエリ</h2>
        <p><code>{{ query }}</code></p>
    {% endif %}

    {% if query_result %}
        <h2>クエリ結果</h2>
        <table border="1">
            <tr style="background-color: rgba(0, 123, 255, 0.664);">
                {% for col in query_result["columns"] %}
                    <th>{{ col }}</th>
                {% endfor %}
            </tr>
            {% for row in query_result["data"] %}
                <tr style="background-color: rgba(0, 123, 255, 0.313);">
                    {% for item in row %}
                        <td>{{ item }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <div class="nav-buttons">
        <a href="/basic/join/multiple_table_join/study" class="prev">◀ 前へ</a>
        <a href="/basic/join/join_quiz" class="next">まとめクイズへ ▶</a>
    </div>
</div>

{% endblock %}
