{% extends "base.html" %}
{% block title %}UPDATEの学習ページ{% endblock %}
{% block content %}

<div class="container">
    <div class="nav-buttons">
        <a href="/index/update?flag=min" class="prev">◀ 前へ</a>
        <a href="/basic/update/single-column/example" class="next">次へ ▶</a>
    </div>
    <h1>1つのカラムに対して1つの条件でレコードを更新する</h1>

    <p><strong>UPDATE文とは:</strong> UPDATE文は、データベースの既存のレコードを更新するために使用されます。特定の条件に基づいて、指定したカラムの値を変更できます。</p>

    <p><strong>基本的な構文:</strong><br>
        <code>UPDATE {テーブル名} SET {カラム名 = 新しい値} WHERE {条件};</code>
    </p>

    {% if error_message %}
        <p style="color: red;">{{ error_message }}</p>
    {% endif %}
    {% if message %}
        <p style="color: green;">{{ message }}</p>
    {% endif %}

    <table border="1">
        <caption>productsテーブル</caption>
        <tr>
            {% for col in products_desc %}
                <th>{{ col[0] }}</th>
            {% endfor %}
        </tr>
        {% for row in products_data %}
            <tr>
                {% for item in row %}
                    <td>{{ item }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <form method="POST">
        <h2>レコードを更新する</h2>
        <p>UPDATE products</p>
        <p>SET
            <select name="column_to_update" required>
                {% for col in products_desc %}
                    <option value="{{ col[0] }}">{{ col[0] }}</option>
                {% endfor %}
            </select>
            =
            <input type="text" name="new_value" placeholder="新しい値" required>
        </p>
        <p>WHERE
            <select name="condition_column" required>
                {% for col in products_desc %}
                    <option value="{{ col[0] }}">{{ col[0] }}</option>
                {% endfor %}
            </select>
            =
            <input type="text" name="condition_value" placeholder="条件の値" required>
        </p>

        <div style="text-align: center; margin-top: 20px;">
            <button type="submit" name="button_val" value="update_record_btn" class="btn">実行する</button>
            <button type="submit" name="button_val" value="restore_backup_btn" onclick="return handleReset()" class="btn">1つ前の状態に戻す</button>
            <button type="submit" name="button_val" value="table_init_btn" onclick="return handleReset()" class="btn">テーブルを初期状態に戻す</button>
        </div>
    </form>

    <div class="nav-buttons">
        <a href="/index/update?flag=min" class="prev">◀ 前へ</a>
        <a href="/basic/update/single-column/example" class="next">次へ ▶</a>
    </div>
</div>

<script>
    function handleReset() {
        const inputs = document.querySelectorAll('form input, form select');
        inputs.forEach(input => input.removeAttribute('required'));
        return true;
    }
</script>

{% endblock %}
